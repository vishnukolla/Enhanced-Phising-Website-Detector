{"cells":[{"cell_type":"code","source":["!pip install gradio python-whois"],"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"B0N3aYhvOrcw","executionInfo":{"status":"ok","timestamp":1730897214600,"user_tz":-330,"elapsed":17696,"user":{"displayName":"Vishnu Priyanka","userId":"03413696733414124071"}},"outputId":"53a7840d-da36-4c05-d2ef-324ef2659a86"},"execution_count":1,"outputs":[{"output_type":"stream","name":"stdout","text":["Collecting gradio\n","  Downloading gradio-5.5.0-py3-none-any.whl.metadata (16 kB)\n","Collecting python-whois\n","  Downloading python_whois-0.9.4-py3-none-any.whl.metadata (2.6 kB)\n","Collecting aiofiles<24.0,>=22.0 (from gradio)\n","  Downloading aiofiles-23.2.1-py3-none-any.whl.metadata (9.7 kB)\n","Requirement already satisfied: anyio<5.0,>=3.0 in /usr/local/lib/python3.10/dist-packages (from gradio) (3.7.1)\n","Collecting fastapi<1.0,>=0.115.2 (from gradio)\n","  Downloading fastapi-0.115.4-py3-none-any.whl.metadata (27 kB)\n","Collecting ffmpy (from gradio)\n","  Downloading ffmpy-0.4.0-py3-none-any.whl.metadata (2.9 kB)\n","Collecting gradio-client==1.4.2 (from gradio)\n","  Downloading gradio_client-1.4.2-py3-none-any.whl.metadata (7.1 kB)\n","Requirement already satisfied: httpx>=0.24.1 in /usr/local/lib/python3.10/dist-packages (from gradio) (0.27.2)\n","Collecting huggingface-hub>=0.25.1 (from gradio)\n","  Downloading huggingface_hub-0.26.2-py3-none-any.whl.metadata (13 kB)\n","Requirement already satisfied: jinja2<4.0 in /usr/local/lib/python3.10/dist-packages (from gradio) (3.1.4)\n","Collecting markupsafe~=2.0 (from gradio)\n","  Downloading MarkupSafe-2.1.5-cp310-cp310-manylinux_2_17_x86_64.manylinux2014_x86_64.whl.metadata (3.0 kB)\n","Requirement already satisfied: numpy<3.0,>=1.0 in /usr/local/lib/python3.10/dist-packages (from gradio) (1.26.4)\n","Requirement already satisfied: orjson~=3.0 in /usr/local/lib/python3.10/dist-packages (from gradio) (3.10.10)\n","Requirement already satisfied: packaging in /usr/local/lib/python3.10/dist-packages (from gradio) (24.1)\n","Requirement already satisfied: pandas<3.0,>=1.0 in /usr/local/lib/python3.10/dist-packages (from gradio) (2.2.2)\n","Requirement already satisfied: pillow<12.0,>=8.0 in /usr/local/lib/python3.10/dist-packages (from gradio) (10.4.0)\n","Requirement already satisfied: pydantic>=2.0 in /usr/local/lib/python3.10/dist-packages (from gradio) (2.9.2)\n","Collecting pydub (from gradio)\n","  Downloading pydub-0.25.1-py2.py3-none-any.whl.metadata (1.4 kB)\n","Collecting python-multipart==0.0.12 (from gradio)\n","  Downloading python_multipart-0.0.12-py3-none-any.whl.metadata (1.9 kB)\n","Requirement already satisfied: pyyaml<7.0,>=5.0 in /usr/local/lib/python3.10/dist-packages (from gradio) (6.0.2)\n","Collecting ruff>=0.2.2 (from gradio)\n","  Downloading ruff-0.7.2-py3-none-manylinux_2_17_x86_64.manylinux2014_x86_64.whl.metadata (25 kB)\n","Collecting safehttpx<1.0,>=0.1.1 (from gradio)\n","  Downloading safehttpx-0.1.1-py3-none-any.whl.metadata (4.1 kB)\n","Collecting semantic-version~=2.0 (from gradio)\n","  Downloading semantic_version-2.10.0-py2.py3-none-any.whl.metadata (9.7 kB)\n","Collecting starlette<1.0,>=0.40.0 (from gradio)\n","  Downloading starlette-0.41.2-py3-none-any.whl.metadata (6.0 kB)\n","Collecting tomlkit==0.12.0 (from gradio)\n","  Downloading tomlkit-0.12.0-py3-none-any.whl.metadata (2.7 kB)\n","Requirement already satisfied: typer<1.0,>=0.12 in /usr/local/lib/python3.10/dist-packages (from gradio) (0.12.5)\n","Requirement already satisfied: typing-extensions~=4.0 in /usr/local/lib/python3.10/dist-packages (from gradio) (4.12.2)\n","Collecting uvicorn>=0.14.0 (from gradio)\n","  Downloading uvicorn-0.32.0-py3-none-any.whl.metadata (6.6 kB)\n","Requirement already satisfied: fsspec in /usr/local/lib/python3.10/dist-packages (from gradio-client==1.4.2->gradio) (2024.10.0)\n","Collecting websockets<13.0,>=10.0 (from gradio-client==1.4.2->gradio)\n","  Downloading websockets-12.0-cp310-cp310-manylinux_2_5_x86_64.manylinux1_x86_64.manylinux_2_17_x86_64.manylinux2014_x86_64.whl.metadata (6.6 kB)\n","Requirement already satisfied: python-dateutil in /usr/local/lib/python3.10/dist-packages (from python-whois) (2.8.2)\n","Requirement already satisfied: idna>=2.8 in /usr/local/lib/python3.10/dist-packages (from anyio<5.0,>=3.0->gradio) (3.10)\n","Requirement already satisfied: sniffio>=1.1 in /usr/local/lib/python3.10/dist-packages (from anyio<5.0,>=3.0->gradio) (1.3.1)\n","Requirement already satisfied: exceptiongroup in /usr/local/lib/python3.10/dist-packages (from anyio<5.0,>=3.0->gradio) (1.2.2)\n","Requirement already satisfied: certifi in /usr/local/lib/python3.10/dist-packages (from httpx>=0.24.1->gradio) (2024.8.30)\n","Requirement already satisfied: httpcore==1.* in /usr/local/lib/python3.10/dist-packages (from httpx>=0.24.1->gradio) (1.0.6)\n","Requirement already satisfied: h11<0.15,>=0.13 in /usr/local/lib/python3.10/dist-packages (from httpcore==1.*->httpx>=0.24.1->gradio) (0.14.0)\n","Requirement already satisfied: filelock in /usr/local/lib/python3.10/dist-packages (from huggingface-hub>=0.25.1->gradio) (3.16.1)\n","Requirement already satisfied: requests in /usr/local/lib/python3.10/dist-packages (from huggingface-hub>=0.25.1->gradio) (2.32.3)\n","Requirement already satisfied: tqdm>=4.42.1 in /usr/local/lib/python3.10/dist-packages (from huggingface-hub>=0.25.1->gradio) (4.66.6)\n","Requirement already satisfied: pytz>=2020.1 in /usr/local/lib/python3.10/dist-packages (from pandas<3.0,>=1.0->gradio) (2024.2)\n","Requirement already satisfied: tzdata>=2022.7 in /usr/local/lib/python3.10/dist-packages (from pandas<3.0,>=1.0->gradio) (2024.2)\n","Requirement already satisfied: annotated-types>=0.6.0 in /usr/local/lib/python3.10/dist-packages (from pydantic>=2.0->gradio) (0.7.0)\n","Requirement already satisfied: pydantic-core==2.23.4 in /usr/local/lib/python3.10/dist-packages (from pydantic>=2.0->gradio) (2.23.4)\n","Requirement already satisfied: six>=1.5 in /usr/local/lib/python3.10/dist-packages (from python-dateutil->python-whois) (1.16.0)\n","Requirement already satisfied: click>=8.0.0 in /usr/local/lib/python3.10/dist-packages (from typer<1.0,>=0.12->gradio) (8.1.7)\n","Requirement already satisfied: shellingham>=1.3.0 in /usr/local/lib/python3.10/dist-packages (from typer<1.0,>=0.12->gradio) (1.5.4)\n","Requirement already satisfied: rich>=10.11.0 in /usr/local/lib/python3.10/dist-packages (from typer<1.0,>=0.12->gradio) (13.9.3)\n","Requirement already satisfied: markdown-it-py>=2.2.0 in /usr/local/lib/python3.10/dist-packages (from rich>=10.11.0->typer<1.0,>=0.12->gradio) (3.0.0)\n","Requirement already satisfied: pygments<3.0.0,>=2.13.0 in /usr/local/lib/python3.10/dist-packages (from rich>=10.11.0->typer<1.0,>=0.12->gradio) (2.18.0)\n","Requirement already satisfied: charset-normalizer<4,>=2 in /usr/local/lib/python3.10/dist-packages (from requests->huggingface-hub>=0.25.1->gradio) (3.4.0)\n","Requirement already satisfied: urllib3<3,>=1.21.1 in /usr/local/lib/python3.10/dist-packages (from requests->huggingface-hub>=0.25.1->gradio) (2.2.3)\n","Requirement already satisfied: mdurl~=0.1 in /usr/local/lib/python3.10/dist-packages (from markdown-it-py>=2.2.0->rich>=10.11.0->typer<1.0,>=0.12->gradio) (0.1.2)\n","Downloading gradio-5.5.0-py3-none-any.whl (56.7 MB)\n","\u001b[2K   \u001b[90m━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\u001b[0m \u001b[32m56.7/56.7 MB\u001b[0m \u001b[31m12.5 MB/s\u001b[0m eta \u001b[36m0:00:00\u001b[0m\n","\u001b[?25hDownloading gradio_client-1.4.2-py3-none-any.whl (319 kB)\n","\u001b[2K   \u001b[90m━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\u001b[0m \u001b[32m319.8/319.8 kB\u001b[0m \u001b[31m18.2 MB/s\u001b[0m eta \u001b[36m0:00:00\u001b[0m\n","\u001b[?25hDownloading python_multipart-0.0.12-py3-none-any.whl (23 kB)\n","Downloading tomlkit-0.12.0-py3-none-any.whl (37 kB)\n","Downloading python_whois-0.9.4-py3-none-any.whl (103 kB)\n","\u001b[2K   \u001b[90m━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\u001b[0m \u001b[32m103.3/103.3 kB\u001b[0m \u001b[31m6.6 MB/s\u001b[0m eta \u001b[36m0:00:00\u001b[0m\n","\u001b[?25hDownloading aiofiles-23.2.1-py3-none-any.whl (15 kB)\n","Downloading fastapi-0.115.4-py3-none-any.whl (94 kB)\n","\u001b[2K   \u001b[90m━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\u001b[0m \u001b[32m94.7/94.7 kB\u001b[0m \u001b[31m5.5 MB/s\u001b[0m eta \u001b[36m0:00:00\u001b[0m\n","\u001b[?25hDownloading huggingface_hub-0.26.2-py3-none-any.whl (447 kB)\n","\u001b[2K   \u001b[90m━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\u001b[0m \u001b[32m447.5/447.5 kB\u001b[0m \u001b[31m20.4 MB/s\u001b[0m eta \u001b[36m0:00:00\u001b[0m\n","\u001b[?25hDownloading MarkupSafe-2.1.5-cp310-cp310-manylinux_2_17_x86_64.manylinux2014_x86_64.whl (25 kB)\n","Downloading ruff-0.7.2-py3-none-manylinux_2_17_x86_64.manylinux2014_x86_64.whl (11.0 MB)\n","\u001b[2K   \u001b[90m━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\u001b[0m \u001b[32m11.0/11.0 MB\u001b[0m \u001b[31m80.3 MB/s\u001b[0m eta \u001b[36m0:00:00\u001b[0m\n","\u001b[?25hDownloading safehttpx-0.1.1-py3-none-any.whl (8.4 kB)\n","Downloading semantic_version-2.10.0-py2.py3-none-any.whl (15 kB)\n","Downloading starlette-0.41.2-py3-none-any.whl (73 kB)\n","\u001b[2K   \u001b[90m━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\u001b[0m \u001b[32m73.3/73.3 kB\u001b[0m \u001b[31m4.4 MB/s\u001b[0m eta \u001b[36m0:00:00\u001b[0m\n","\u001b[?25hDownloading uvicorn-0.32.0-py3-none-any.whl (63 kB)\n","\u001b[2K   \u001b[90m━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\u001b[0m \u001b[32m63.7/63.7 kB\u001b[0m \u001b[31m3.9 MB/s\u001b[0m eta \u001b[36m0:00:00\u001b[0m\n","\u001b[?25hDownloading ffmpy-0.4.0-py3-none-any.whl (5.8 kB)\n","Downloading pydub-0.25.1-py2.py3-none-any.whl (32 kB)\n","Downloading websockets-12.0-cp310-cp310-manylinux_2_5_x86_64.manylinux1_x86_64.manylinux_2_17_x86_64.manylinux2014_x86_64.whl (130 kB)\n","\u001b[2K   \u001b[90m━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\u001b[0m \u001b[32m130.2/130.2 kB\u001b[0m \u001b[31m6.2 MB/s\u001b[0m eta \u001b[36m0:00:00\u001b[0m\n","\u001b[?25hInstalling collected packages: pydub, websockets, uvicorn, tomlkit, semantic-version, ruff, python-multipart, markupsafe, ffmpy, aiofiles, starlette, python-whois, huggingface-hub, safehttpx, gradio-client, fastapi, gradio\n","  Attempting uninstall: markupsafe\n","    Found existing installation: MarkupSafe 3.0.2\n","    Uninstalling MarkupSafe-3.0.2:\n","      Successfully uninstalled MarkupSafe-3.0.2\n","  Attempting uninstall: huggingface-hub\n","    Found existing installation: huggingface-hub 0.24.7\n","    Uninstalling huggingface-hub-0.24.7:\n","      Successfully uninstalled huggingface-hub-0.24.7\n","Successfully installed aiofiles-23.2.1 fastapi-0.115.4 ffmpy-0.4.0 gradio-5.5.0 gradio-client-1.4.2 huggingface-hub-0.26.2 markupsafe-2.1.5 pydub-0.25.1 python-multipart-0.0.12 python-whois-0.9.4 ruff-0.7.2 safehttpx-0.1.1 semantic-version-2.10.0 starlette-0.41.2 tomlkit-0.12.0 uvicorn-0.32.0 websockets-12.0\n"]}]},{"cell_type":"code","source":["import numpy as np\n","import pandas as pd\n","import matplotlib.pyplot as plt\n","import seaborn as sns\n","from sklearn import metrics\n","import warnings\n","import re\n","from datetime import datetime\n","import whois\n","import ssl\n","import socket\n","import requests\n","import gradio as gr\n","\n","warnings.filterwarnings('ignore')\n","\n","# Load data\n","data = pd.read_csv(\"/content/phishing.csv\")\n","data = data.drop(['Index'], axis=1)  # Dropping index column\n","\n","\n","# Splitting dataset into independent and dependent features\n","X = data.drop([\"class\"], axis=1)\n","y = data[\"class\"]\n","\n","\n","# Splitting dataset into train and test sets\n","from sklearn.model_selection import train_test_split\n","X_train, X_test, y_train, y_test = train_test_split(X, y, test_size=0.2, random_state=42)\n","\n","# Logistic Regression model\n","from sklearn.linear_model import LogisticRegression\n","log = LogisticRegression()\n","log.fit(X_train, y_train)\n","\n","# URL analysis functions\n","def has_ip_address(url):\n","    return bool(re.search(r'\\b\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\b', url))\n","\n","def url_length(url):\n","    return len(url)\n","\n","def count_special_characters(url):\n","    return sum([1 for char in url if char in ['@', '-', '_', '.', '/']])\n","\n","def is_https(url):\n","    return url.startswith(\"https://\")\n","\n","def domain_age(domain_name):\n","    try:\n","        domain_info = whois.whois(domain_name)\n","        creation_date = domain_info.creation_date\n","        if isinstance(creation_date, list):\n","            creation_date = creation_date[0]\n","        if creation_date:\n","            age_days = (datetime.now() - creation_date).days\n","            return age_days <= 365  # True if domain is less than 1 year old\n","    except:\n","        return True  # Default to True if domain info isn't available\n","\n","# New Credibility Score Functions\n","def get_domain_age(domain_name):\n","    try:\n","        domain_info = whois.whois(domain_name)\n","        creation_date = domain_info.creation_date\n","        if isinstance(creation_date, list):  # In case multiple dates are returned\n","            creation_date = creation_date[0]\n","        domain_age = (datetime.now() - creation_date).days if creation_date else 0\n","        return domain_age\n","    except Exception as e:\n","        print(f\"Error retrieving domain age: {e}\")\n","        return None\n","\n","def get_ssl_certificate_expiry(domain_name):\n","    try:\n","        context = ssl.create_default_context()\n","        with socket.create_connection((domain_name, 443)) as sock:\n","            with context.wrap_socket(sock, server_hostname=domain_name) as ssock:\n","                cert = ssock.getpeercert()\n","                expiry_date = datetime.strptime(cert['notAfter'], \"%b %d %H:%M:%S %Y %Z\")\n","                days_left = (expiry_date - datetime.now()).days\n","                return days_left\n","    except Exception as e:\n","        print(f\"Error retrieving SSL certificate info: {e}\")\n","        return None\n","\n","def check_domain_reputation(domain_name):\n","    try:\n","        # VirusTotal API example (replace 'YOUR_API_KEY' with your actual API key)\n","        api_key = 'bd39b116654447fdcab390e730cf68fe3ac866a44d00d09d285df8f7962164c2'\n","        url = f\"https://www.virustotal.com/api/v3/domains/{domain_name}\"\n","        headers = {\"x-apikey\": api_key}\n","        response = requests.get(url, headers=headers)\n","\n","        if response.status_code == 200:\n","            data = response.json()\n","            reputation_score = data['data']['attributes']['reputation']\n","            return reputation_score  # +ve score indicates credibility, -ve score indicates risk\n","        else:\n","            print(\"Could not retrieve reputation info\")\n","            return None\n","    except Exception as e:\n","        print(f\"Error retrieving reputation info: {e}\")\n","        return None\n","\n","def url_analysis(url):\n","    analysis = {\n","        \"length\": url_length(url),\n","        \"has_ip\": has_ip_address(url),\n","        \"special_characters\": count_special_characters(url),\n","        \"https\": is_https(url)\n","    }\n","    domain = re.findall(r'https?://([^/]+)', url)\n","    analysis[\"recently_created\"] = domain_age(domain[0]) if domain else None\n","\n","    suspicious_reasons = []\n","    if analysis[\"length\"] > 75:\n","        suspicious_reasons.append(\"URL is very long.\")\n","    if analysis[\"has_ip\"]:\n","        suspicious_reasons.append(\"URL contains an IP address.\")\n","    if analysis[\"special_characters\"] > 5:\n","        suspicious_reasons.append(\"URL has too many special characters.\")\n","    if not analysis[\"https\"]:\n","        suspicious_reasons.append(\"URL does not use HTTPS.\")\n","    if analysis[\"recently_created\"]:\n","        suspicious_reasons.append(\"Domain was registered recently.\")\n","\n","    is_fake = len(suspicious_reasons) > 0\n","\n","    # Credibility Score Calculation\n","    domain_name = domain[0] if domain else None\n","    credibility_score, trust_level = None, \"Unknown\"\n","\n","    if domain_name:\n","        age = get_domain_age(domain_name)\n","        ssl_days_left = get_ssl_certificate_expiry(domain_name)\n","        reputation = check_domain_reputation(domain_name)\n","\n","        # Simple credibility scoring logic\n","        credibility_score = 0\n","        if age:\n","            credibility_score += min(age / 365, 1) * 0.4  # 40% weight for age\n","        if ssl_days_left:\n","            credibility_score += min(ssl_days_left / 365, 1) * 0.3  # 30% weight for SSL\n","        if reputation is not None:\n","            credibility_score += (reputation / 100) * 0.3  # 30% weight for reputation\n","\n","        credibility_score = round(credibility_score * 100, 2)\n","        trust_level = \"High Trust\" if credibility_score > 75 else \"Moderate Trust\" if credibility_score > 50 else \"Low Trust\"\n","\n","    result = {\n","        \"Prediction\": \"Fake\" if is_fake else \"Legit\",\n","        \"Reasons\": suspicious_reasons,\n","        \"Recently Created Domain\": \"Yes\" if analysis[\"recently_created\"] else \"No\",\n","        \"Credibility Score (%)\": credibility_score,\n","        \"Trust Level\": trust_level\n","    }\n","    return result\n","\n","# Gradio Interface\n","def analyze_url_gradio(url):\n","    result = url_analysis(url)\n","    return (\n","        f\"Prediction: {result['Prediction']}\",\n","        result['Reasons'],\n","        result['Recently Created Domain'],\n","        result['Credibility Score (%)'],\n","        result['Trust Level']\n","    )\n","\n","# Define Gradio inputs and outputs\n","url_input = gr.Textbox(lines=1, placeholder=\"Enter URL here...\", label=\"URL\")\n","output_text = gr.Textbox(label=\"Prediction\")\n","output_reasons = gr.Textbox(label=\"Reasons\")\n","output_recently_created = gr.Textbox(label=\"Recently Created Domain\")\n","output_credibility_score = gr.Textbox(label=\"Credibility Score (%)\")\n","output_trust_level = gr.Textbox(label=\"Trust Level\")\n","\n","# Launch Gradio Interface\n","iface = gr.Interface(\n","    fn=analyze_url_gradio,\n","    inputs=url_input,\n","    outputs=[output_text, output_reasons, output_recently_created, output_credibility_score, output_trust_level],\n","    title=\"Enhanced Phishing URL Analysis\",\n","    description=\"Enter a URL to analyze its credibility, trust level, and determine if it may be suspicious.\"\n",")\n","\n","iface.launch(share=True)\n"],"metadata":{"colab":{"base_uri":"https://localhost:8080/","height":611},"id":"94FNSo_pPFFg","executionInfo":{"status":"ok","timestamp":1730897340661,"user_tz":-330,"elapsed":12479,"user":{"displayName":"Vishnu Priyanka","userId":"03413696733414124071"}},"outputId":"2ee9c19e-5f8f-4d2c-c332-ae9ea090b9a3"},"execution_count":2,"outputs":[{"output_type":"stream","name":"stdout","text":["Colab notebook detected. To show errors in colab notebook, set debug=True in launch()\n","* Running on public URL: https://db1f6755504c98c8e5.gradio.live\n","\n","This share link expires in 72 hours. For free permanent hosting and GPU upgrades, run `gradio deploy` from the terminal in the working directory to deploy to Hugging Face Spaces (https://huggingface.co/spaces)\n"]},{"output_type":"display_data","data":{"text/plain":["<IPython.core.display.HTML object>"],"text/html":["<div><iframe src=\"https://db1f6755504c98c8e5.gradio.live\" width=\"100%\" height=\"500\" allow=\"autoplay; camera; microphone; clipboard-read; clipboard-write;\" frameborder=\"0\" allowfullscreen></iframe></div>"]},"metadata":{}},{"output_type":"execute_result","data":{"text/plain":[]},"metadata":{},"execution_count":2}]}],"metadata":{"colab":{"provenance":[],"authorship_tag":"ABX9TyMXgsOGUtBAl3+ney8GeW9v"},"kernelspec":{"display_name":"Python 3","name":"python3"},"language_info":{"name":"python"}},"nbformat":4,"nbformat_minor":0}